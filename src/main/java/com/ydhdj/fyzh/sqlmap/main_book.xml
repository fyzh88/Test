<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="itpdf_main">	

	<resultMap type="BookInfoBean" id="bookid">
		<id property="id" column="id"/>
		<id property="user_id" column="user_id"/>
		<id property="date" column="date"/>
		<id property="name" column="name"/>
		<id property="author" column="author"/>
		<id property="pages" column="pages"/>
		<id property="md" column="md"/>
		<id property="save_name" column="save_name"/>
		<id property="file_len" column="file_len"/>
		<id property="shared_addr" column="shared_addr"/>
		<id property="share_code" column="share_code"/>
	</resultMap>
	
	<!-- 获取PDF书籍分类信息 -->
	<select id="getAllCategory" resultType ="hashmap" parameterType="int">
		SELECT category,COUNT(category) AS cnt FROM itpdf_books GROUP BY category ORDER BY date DESC 
		 <if test="_parameter > 0">
		 	LIMIT #{limitCnt};
		 </if>
	</select>
	
	<!-- 获取某PDF分类中的书籍信息 -->
	<select id="getByCategory" resultType="BookInfoBean" parameterType="hashmap">
		SELECT * FROM itpdf_books WHERE category=#{category} ORDER BY date DESC LIMIT #{start},#{limitCnt};
	</select>
	
	<!-- 获取某个分类中的PDF文件数量 -->
	<select id="getTotalInCategory" resultType="hashmap" parameterType="str">
		SELECT COUNT(0) AS cnt FROM itpdf_books WHERE category=#{category};
	</select>
	<!--依据文件的消息摘要获取-->
	<select id="getByMd" resultType="BookInfoBean" parameterType="str">
		SELECT * FROM itpdf_books WHERE md=#{md};
	</select>
	<!-- 依据id 获取数据 -->
	<select id="getById" resultType="BookInfoBean" parameterType="str">
		SELECT * FROM itpdf_books WHERE id=#{id};
	</select>
	<!-- 插入book数据 -->
	<insert id="insert" parameterType="BookInfoBean">
		INSERT INTO itpdf_books(id,user_id,md,file_len,name,save_name,author,pages,publisher,category,shared_addr,share_code) 
		VALUES(#{id},#{user_id},#{md},#{file_len},#{name},#{save_name},#{author},#{pages},#{publisher},#{category},#{shared_addr},#{share_code});
	</insert>
	<!-- 站内搜索 -->
	<select id="searchInSite" parameterType="hashmap" resultType="BookInfoBean">
		SELECT * FROM itpdf_books WHERE name LIKE %#{key}% ORDER BY date DESC LIMIT #{start},#{limitCnt};
	</select>
	<!--  -->
	<select id="getTotalWithKey" resultType="hashmap" parameterType="str">
		SELECT COUNT(0) AS cnt FROM itpdf_books WHERE name LIKE %#{key};
	</select>
</mapper> 
